<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Gerenciar Projeto com Imagem</title>
</head>
<body>
<h1>Criar Projeto com Imagem</h1>

<!-- Form para criar projeto -->
<form id="projetoForm" enctype="multipart/form-data">
    <label for="nome">Nome:</label>
    <input type="text" id="nome" name="nome" value="" required><br><br>

    <label for="descricao">Descrição:</label>
    <textarea id="descricao" name="descricao"></textarea><br><br>

    <label for="area">Área:</label>
    <input type="text" id="area" name="area" value=""><br><br>

    <label for="status">Status:</label>
    <input type="checkbox" id="status" name="status" checked><br><br>

    <label for="dataInicio">Data Início:</label>
    <input type="date" id="dataInicio" name="dataInicio" value="2025-05-10"><br><br>

    <label for="dataFim">Data Fim:</label>
    <input type="date" id="dataFim" name="dataFim" value="2025-11-30"><br><br>

    <label for="cargaHoraria">Carga Horária:</label>
    <input type="number" id="cargaHoraria" name="cargaHoraria" value=""><br><br>

    <label for="formato">Formato:</label>
    <select id="formato" name="formato">
        <option value="PRESENCIAL">Presencial</option>
        <option value="ONLINE">Online</option>
        <option value="HIBRIDO" selected>Híbrido</option>
    </select><br><br>

    <label for="imagem">Imagem do Projeto:</label>
    <input type="file" id="imagem" name="imagem" accept="image/*" required><br><br>

    <button type="submit">Criar Projeto</button>
</form>

<h2>Buscar Projeto pelo ID</h2>
<label for="projetoId">ID do Projeto:</label>
<input type="number" id="projetoId">
<button id="buscarBtn">Buscar</button>

<h2>Dados do Projeto:</h2>
<p><b>Nome:</b> <span id="nomeProj"></span></p>
<p><b>Descrição:</b> <span id="descricaoProj"></span></p>
<p><b>Área:</b> <span id="areaProj"></span></p>
<p><b>Status:</b> <span id="statusProj"></span></p>
<p><b>Data Início:</b> <span id="dataInicioProj"></span></p>
<p><b>Data Fim:</b> <span id="dataFimProj"></span></p>
<p><b>Carga Horária:</b> <span id="cargaHorariaProj"></span></p>
<p><b>Formato:</b> <span id="formatoProj"></span></p>

<h2>Imagem do Projeto:</h2>
<img id="projetoImagem" src="" alt="Imagem do Projeto" width="300">

<script>
    // --- Criar projeto ---
    const form = document.getElementById('projetoForm');
    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const projetoData = {
            nome: document.getElementById('nome').value,
            descricao: document.getElementById('descricao').value,
            area: document.getElementById('area').value,
            status: document.getElementById('status').checked,
            dataInicio: document.getElementById('dataInicio').value,
            dataFim: document.getElementById('dataFim').value,
            cargaHoraria: parseFloat(document.getElementById('cargaHoraria').value),
            instituicaoEnsino: null,
            formato: document.getElementById('formato').value,
            coordenadores: [],
            participantes: [],
            contatos: []
        };

        const imagemFile = document.getElementById('imagem').files[0];

        const formData = new FormData();
        const projetoBlob = new Blob([JSON.stringify(projetoData)], { type: 'application/json' });
        formData.append("projeto", projetoBlob);
        formData.append("imagem", imagemFile);

        try {
            // URL relativa -> mesma origem
            const response = await fetch('/api/projetos', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) throw new Error("Erro ao criar projeto");

            const projetoCriado = await response.json();
            alert(`Projeto criado com ID: ${projetoCriado.id}`);

            // Atualiza imagem
            document.getElementById('projetoImagem').src = `/api/projetos/${projetoCriado.id}/imagem`;

            // Preenche automaticamente os dados do projeto recém-criado
            document.getElementById("nomeProj").textContent = projetoCriado.nome;
            document.getElementById("descricaoProj").textContent = projetoCriado.descricao;
            document.getElementById("areaProj").textContent = projetoCriado.area;
            document.getElementById("statusProj").textContent = projetoCriado.status;
            document.getElementById("dataInicioProj").textContent = projetoCriado.dataInicio;
            document.getElementById("dataFimProj").textContent = projetoCriado.dataFim;
            document.getElementById("cargaHorariaProj").textContent = projetoCriado.cargaHoraria;
            document.getElementById("formatoProj").textContent = projetoCriado.formato;

        } catch (err) {
            alert(err);
        }
    });

    // --- Buscar projeto pelo ID ---
    document.getElementById("buscarBtn").addEventListener("click", async () => {
        const id = document.getElementById("projetoId").value;
        if (!id) return alert("Digite um ID válido!");

        try {
            // URL relativa -> mesma origem
            const response = await fetch(`/api/projetos/${id}`);
            if (!response.ok) throw new Error("Projeto não encontrado");
            const projeto = await response.json();

            // Preencher dados no HTML
            document.getElementById("nomeProj").textContent = projeto.nome;
            document.getElementById("descricaoProj").textContent = projeto.descricao;
            document.getElementById("areaProj").textContent = projeto.area;
            document.getElementById("statusProj").textContent = projeto.status;
            document.getElementById("dataInicioProj").textContent = projeto.dataInicio;
            document.getElementById("dataFimProj").textContent = projeto.dataFim;
            document.getElementById("cargaHorariaProj").textContent = projeto.cargaHoraria;
            document.getElementById("formatoProj").textContent = projeto.formato;

            // Mostrar imagem
            document.getElementById("projetoImagem").src = `/api/projetos/${id}/imagem`;
        } catch (err) {
            alert(err);
        }
    });
</script>
</body>
</html>
